/*! HTML5 Finder - v0.2.3rc2 - 2013-09-17
* https://github.com/jgerigmeyer/jquery-html5finder
* Copyright (c) 2013 Jonny Gerig Meyer; Licensed MIT */
(function(e){"use strict";var t={},l={init:function(t){var n=e.extend({},e.fn.html5finder.defaults,t),c=e(this),o=c.find(n.finderSelector),a=o.find(n.sectionSelector).length||1;l.updateNumberCols(o,a),l.markSelected(o,t),l.attachHandler(c,o,t)},markSelected:function(t,l){var n=e.extend({},e.fn.html5finder.defaults,l);t.find(n.selected).data("selected",!0),t.find(n.notSelected).data("selected",!1)},updateNumberCols:function(e,t){e.data("cols",t).attr("data-cols",t)},horzScroll:function(t,l,n){var c=e.extend({},e.fn.html5finder.defaults,n);if(c.horizontalScroll){var o,a=l.scrollLeft(),d=t.find(c.sectionSelector+".focus").prev(c.sectionSelector);o=d.length?a+d.position().left:0,l.animate({scrollLeft:o})}},addItems:function(t,n,c,o,a,d){var i,r=e.extend({},e.fn.html5finder.defaults,d),s=o.find(r.scrollContainer);t.colname=n,i=r.itemTplFn(t),c.find(r.sectionContentSelector).html(i),l.horzScroll(a,s,d),r.itemsAddedCallback&&r.itemsAddedCallback(i)},attachHandler:function(t,n,c){var o=e.extend({},e.fn.html5finder.defaults,c);n.on("click",o.itemSelector,function(){l.itemClick(t,n,e(this),c)})},itemClick:function(n,c,o,a){var d,i,r,s=e.extend({},e.fn.html5finder.defaults,a),f=n.find(s.scrollContainer),u=o.closest(s.sectionSelector),m=o.data("url"),h=u.next(s.sectionSelector);if(o.data("selected")===!0)u.hasClass("focus")?h.addClass("focus").siblings(s.sectionSelector).removeClass("focus"):u.addClass("focus").siblings(s.sectionSelector).removeClass("focus"),h.find("input:checked").removeAttr("checked").data("selected",!1),h.nextAll(s.sectionSelector).remove(),r=c.find(s.sectionSelector).length,l.updateNumberCols(c,r),l.horzScroll(c,f,a),o.data("children")&&s.itemSelectedCallback&&s.itemSelectedCallback(o);else{if(o.data("children")){if(r=u.prevAll(s.sectionSelector).addBack().removeClass("focus").length+1,l.updateNumberCols(c,r),d="col"+(""+r),i=s.columnTplFn({colname:d}),u.nextAll(s.sectionSelector).remove(),u.after(i),s.cache&&t[o.attr("id")]){var S=t[o.attr("id")];l.addItems(S,d,i,n,c,a)}else s.loading&&i.loadingOverlay(),e.when(e.get(m)).done(function(e){t[o.attr("id")]=e,l.addItems(e,d,i,n,c,a)}).always(function(){s.loading&&i.loadingOverlay("remove")});s.itemSelectedCallback&&s.itemSelectedCallback(o)}else u.addClass("focus").siblings(s.sectionSelector).removeClass("focus"),u.nextAll(s.sectionSelector).remove(),r=c.find(s.sectionSelector).length,l.updateNumberCols(c,r),s.lastChildSelectedCallback&&s.lastChildSelectedCallback(o);l.markSelected(c,a)}},exposeMethods:function(){return l}};e.fn.html5finder=function(t){return l[t]?l[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(e.error("Method "+t+" does not exist on jQuery.html5finder"),void 0):l.init.apply(this,arguments)},e.fn.html5finder.defaults={itemTplFn:null,columnTplFn:null,loading:!1,horizontalScroll:!1,scrollContainer:null,scrollSpeed:500,selected:"input:checked",notSelected:"input:not(:checked)",finderSelector:".finder-body",headerSelector:"header",sectionSelector:null,sectionContentSelector:null,itemSelector:".finderinput",itemSelectedCallback:null,lastChildSelectedCallback:null,itemsAddedCallback:null,sortLinkSelector:".sortlink",cache:!0}})(jQuery);