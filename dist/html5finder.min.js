/*! HTML5 Finder - v0.2.3rc3 - 2013-09-20
* https://github.com/jgerigmeyer/jquery-html5finder
* Copyright (c) 2013 Jonny Gerig Meyer; Licensed MIT */
!function(a){"use strict";var b={},c={init:function(b){var d=a.extend({},a.fn.html5finder.defaults,b),e=a(this),f=e.find(d.finderSelector),g=f.find(d.sectionSelector).length||1;c.updateNumberCols(f,g),c.markSelected(f,b),c.attachHandler(e,f,b)},markSelected:function(b,c){var d=a.extend({},a.fn.html5finder.defaults,c);b.find(d.selected).data("selected",!0),b.find(d.notSelected).data("selected",!1)},updateNumberCols:function(a,b){a.data("cols",b).attr("data-cols",b)},horzScroll:function(b,c,d){var e=a.extend({},a.fn.html5finder.defaults,d);if(e.horizontalScroll){var f,g=c.scrollLeft(),h=b.find(e.sectionSelector+".focus").prev(e.sectionSelector);f=h.length?g+h.position().left:0,c.animate({scrollLeft:f})}},addItems:function(b,d,e,f,g,h){var i,j=a.extend({},a.fn.html5finder.defaults,h),k=f.find(j.scrollContainer);b.colname=d,i=j.itemTplFn(b),e.find(j.sectionContentSelector).html(i),c.horzScroll(g,k,h),j.itemsAddedCallback&&j.itemsAddedCallback(i)},attachHandler:function(b,d,e){var f=a.extend({},a.fn.html5finder.defaults,e),g=b.find(f.scrollContainer);d.on("click",f.itemSelector,function(){c.itemClick(b,d,a(this),e)}),d.on("click",f.labelSelector,function(){var b=a(this),h=b.closest(f.sectionSelector);h.find("#"+b.attr("for")).is(":disabled")&&(h.addClass("focus").siblings(f.sectionSelector).removeClass("focus"),c.horzScroll(d,g,e))}),d.on("click",f.sectionSelector,function(b){var h=a(this);a(b.target).is("input, label")||(h.addClass("focus").siblings(f.sectionSelector).removeClass("focus"),c.horzScroll(d,g,e))})},itemClick:function(d,e,f,g){var h,i,j,k=a.extend({},a.fn.html5finder.defaults,g),l=d.find(k.scrollContainer),m=f.closest(k.sectionSelector),n=f.data("url"),o=m.next(k.sectionSelector);if(f.data("selected")===!0)m.hasClass("focus")?o.addClass("focus").siblings(k.sectionSelector).removeClass("focus"):m.addClass("focus").siblings(k.sectionSelector).removeClass("focus"),o.find("input:checked").removeAttr("checked").data("selected",!1),o.nextAll(k.sectionSelector).remove(),j=e.find(k.sectionSelector).length,c.updateNumberCols(e,j),c.horzScroll(e,l,g),f.data("children")&&k.itemSelectedCallback&&k.itemSelectedCallback(f);else{if(f.data("children")){if(j=m.prevAll(k.sectionSelector).addBack().removeClass("focus").length+1,c.updateNumberCols(e,j),h="col"+j.toString(),i=k.columnTplFn({colname:h}),m.nextAll(k.sectionSelector).remove(),m.after(i),k.cache&&b[f.attr("id")]){var p=b[f.attr("id")];c.addItems(p,h,i,d,e,g)}else k.loading&&i.loadingOverlay(),a.when(a.get(n)).done(function(a){b[f.attr("id")]=a,c.addItems(a,h,i,d,e,g)}).always(function(){k.loading&&i.loadingOverlay("remove")});k.itemSelectedCallback&&k.itemSelectedCallback(f)}else m.addClass("focus").siblings(k.sectionSelector).removeClass("focus"),m.nextAll(k.sectionSelector).remove(),j=e.find(k.sectionSelector).length,c.updateNumberCols(e,j),c.horzScroll(e,l,g),k.lastChildSelectedCallback&&k.lastChildSelectedCallback(f);c.markSelected(e,g)}},exposeMethods:function(){return c}};a.fn.html5finder=function(b){return c[b]?c[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?(a.error("Method "+b+" does not exist on jQuery.html5finder"),void 0):c.init.apply(this,arguments)},a.fn.html5finder.defaults={itemTplFn:null,columnTplFn:null,loading:!1,horizontalScroll:!1,scrollContainer:null,scrollSpeed:500,selected:"input:checked",notSelected:"input:not(:checked)",finderSelector:".finder-body",headerSelector:"header",sectionSelector:null,sectionContentSelector:null,itemSelector:".finderinput",labelSelector:".finderselect",itemSelectedCallback:null,lastChildSelectedCallback:null,itemsAddedCallback:null,sortLinkSelector:".sortlink",cache:!0}}(jQuery);