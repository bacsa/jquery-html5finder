/*! HTML5 Finder - v0.2.0 - 2013-08-28
* https://github.com/jgerigmeyer/jquery-html5finder
* Copyright (c) 2013 Jonny Gerig Meyer; Licensed MIT */
(function(e){"use strict";var t={},l={init:function(t){var n=e.extend({},e.fn.html5finder.defaults,t),o=e(this),c=o.find(".finder"),r=c.find(n.sectionSelector).length||1;l.updateNumberCols(c,r),l.markSelected(c,t),l.attachHandler(o,c,t)},markSelected:function(t,l){var n=e.extend({},e.fn.html5finder.defaults,l);t.find(n.selected).data("selected",!0),t.find(n.notSelected).data("selected",!1)},updateNumberCols:function(e,t){e.data("cols",t).attr("data-cols",t)},horzScroll:function(t,l,n){var o=e.extend({},e.fn.html5finder.defaults,n);if(o.horizontalScroll===!0){var c,r=l.scrollLeft();c=t.find(o.sectionSelector+".focus").prev(o.sectionSelector).length?r+t.find(o.sectionSelector+".focus").prev(o.sectionSelector).position().left:0,l.animate({scrollLeft:c})}},addItems:function(t,n,o,c,r,a){var i,s=e.extend({},e.fn.html5finder.defaults,a),d=c.find(s.scrollContainer);t.colname=n,i=s.itemTplFn(t),o.find(s.sectionContentSelector).html(i),l.horzScroll(r,d,a),s.loading===!0&&o.loadingOverlay("remove")},attachHandler:function(t,n,o){var c=e.extend({},e.fn.html5finder.defaults,o);n.on("click",c.itemSelector,function(){l.itemClick(t,n,e(this),o)})},itemClick:function(n,o,c,r){var a,i,s,d=e.extend({},e.fn.html5finder.defaults,r),f=n.find(d.scrollContainer),u=c.closest(d.sectionSelector),m=c.data("url"),h=u.next(d.sectionSelector);if(c.data("selected")===!0)u.hasClass("focus")?h.addClass("focus").siblings(d.sectionSelector).removeClass("focus"):u.addClass("focus").siblings(d.sectionSelector).removeClass("focus"),h.find("input:checked").removeAttr("checked").data("selected",!1),h.nextAll(d.sectionSelector).remove(),s=o.find(d.sectionSelector).length,l.updateNumberCols(o,s),l.horzScroll(o,f,r),c.data("children")&&d.callback&&d.callback();else{if(c.data("children")){if(s=u.prevAll(d.sectionSelector).addBack().removeClass("focus").length+1,l.updateNumberCols(o,s),a="col"+(""+s),i=d.columnTplFn({colname:a}),u.nextAll(d.sectionSelector).remove(),u.after(i),d.loading===!0&&i.loadingOverlay(),t[c.attr("id")]){var S=t[c.attr("id")];l.addItems(S,a,i,n,o,r)}else e.get(m,function(e){t[c.attr("id")]=e,l.addItems(e,a,i,n,o,r)},"json");d.callback&&d.callback()}else u.addClass("focus").siblings(d.sectionSelector).removeClass("focus"),u.nextAll(d.sectionSelector).remove(),s=o.find(d.sectionSelector).length,l.updateNumberCols(o,s),d.lastChildCallback&&d.lastChildCallback(c);l.markSelected(o,r)}},exposeMethods:function(){return l}};e.fn.html5finder=function(t){return l[t]?l[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(e.error("Method "+t+" does not exist on jQuery.html5finder"),void 0):l.init.apply(this,arguments)},e.fn.html5finder.defaults={itemTplFn:null,columnTplFn:null,loading:!1,horizontalScroll:!1,scrollContainer:null,scrollSpeed:500,selected:"input:checked",notSelected:"input:not(:checked)",headerSelector:"header",sectionSelector:null,sectionContentSelector:null,itemSelector:".finderinput",callback:null,lastChildCallback:null,sortLinkSelector:".sortlink"}})(jQuery);