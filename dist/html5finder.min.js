/*! HTML5 Finder - v0.2.2 - 2013-09-16
* https://github.com/jgerigmeyer/jquery-html5finder
* Copyright (c) 2013 Jonny Gerig Meyer; Licensed MIT */
(function(e){"use strict";var t={},l={init:function(t){var n=e.extend({},e.fn.html5finder.defaults,t),o=e(this),c=o.find(n.finderSelector),i=c.find(n.sectionSelector).length||1;l.updateNumberCols(c,i),l.markSelected(c,t),l.attachHandler(o,c,t)},markSelected:function(t,l){var n=e.extend({},e.fn.html5finder.defaults,l);t.find(n.selected).data("selected",!0),t.find(n.notSelected).data("selected",!1)},updateNumberCols:function(e,t){e.data("cols",t).attr("data-cols",t)},horzScroll:function(t,l,n){var o=e.extend({},e.fn.html5finder.defaults,n);if(o.horizontalScroll===!0){var c,i=l.scrollLeft();c=t.find(o.sectionSelector+".focus").prev(o.sectionSelector).length?i+t.find(o.sectionSelector+".focus").prev(o.sectionSelector).position().left:0,l.animate({scrollLeft:c})}},addItems:function(t,n,o,c,i,d){var a,r=e.extend({},e.fn.html5finder.defaults,d),s=c.find(r.scrollContainer);t.colname=n,a=r.itemTplFn(t),o.find(r.sectionContentSelector).html(a),l.horzScroll(i,s,d),r.loading===!0&&o.loadingOverlay("remove"),r.itemsAddedCallback&&r.itemsAddedCallback(a)},attachHandler:function(t,n,o){var c=e.extend({},e.fn.html5finder.defaults,o);n.on("click",c.itemSelector,function(){l.itemClick(t,n,e(this),o)})},itemClick:function(n,o,c,i){var d,a,r,s=e.extend({},e.fn.html5finder.defaults,i),f=n.find(s.scrollContainer),u=c.closest(s.sectionSelector),m=c.data("url"),S=u.next(s.sectionSelector);if(c.data("selected")===!0)u.hasClass("focus")?S.addClass("focus").siblings(s.sectionSelector).removeClass("focus"):u.addClass("focus").siblings(s.sectionSelector).removeClass("focus"),S.find("input:checked").removeAttr("checked").data("selected",!1),S.nextAll(s.sectionSelector).remove(),r=o.find(s.sectionSelector).length,l.updateNumberCols(o,r),l.horzScroll(o,f,i),c.data("children")&&s.itemSelectedCallback&&s.itemSelectedCallback(c);else{if(c.data("children")){if(r=u.prevAll(s.sectionSelector).addBack().removeClass("focus").length+1,l.updateNumberCols(o,r),d="col"+(""+r),a=s.columnTplFn({colname:d}),u.nextAll(s.sectionSelector).remove(),u.after(a),s.loading===!0&&a.loadingOverlay(),t[c.attr("id")]){var h=t[c.attr("id")];l.addItems(h,d,a,n,o,i)}else e.get(m,function(e){t[c.attr("id")]=e,l.addItems(e,d,a,n,o,i)},"json");s.itemSelectedCallback&&s.itemSelectedCallback(c)}else u.addClass("focus").siblings(s.sectionSelector).removeClass("focus"),u.nextAll(s.sectionSelector).remove(),r=o.find(s.sectionSelector).length,l.updateNumberCols(o,r),s.lastChildSelectedCallback&&s.lastChildSelectedCallback(c);l.markSelected(o,i)}},exposeMethods:function(){return l}};e.fn.html5finder=function(t){return l[t]?l[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(e.error("Method "+t+" does not exist on jQuery.html5finder"),void 0):l.init.apply(this,arguments)},e.fn.html5finder.defaults={itemTplFn:null,columnTplFn:null,loading:!1,horizontalScroll:!1,scrollContainer:null,scrollSpeed:500,selected:"input:checked",notSelected:"input:not(:checked)",finderSelector:".finder-body",headerSelector:"header",sectionSelector:null,sectionContentSelector:null,itemSelector:".finderinput",itemSelectedCallback:null,lastChildSelectedCallback:null,itemsAddedCallback:null,sortLinkSelector:".sortlink"}})(jQuery);